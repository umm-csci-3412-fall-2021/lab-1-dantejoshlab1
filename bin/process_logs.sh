#!/usr/bin/env bash

#create scratch directory
scratchDir=$(mktemp -d)

#Loop through all arguments 
#Create file name with .tgz extension removed
#Make a new directory inside the scratch directory with the name variable
#Extract tar file in var to the "$name" directory inside the scratch directory
#Call process client logs on that directory
for var in "$@"
do
	name=$(basename "$var" .tgz)
        mkdir "$scratchDir"/"$name"
	tar -xzf "$var" --directory "$scratchDir"/"$name"
	./bin/process_client_logs.sh "$scratchDir"/"$name"	
done

#Call all helper scripts on the scratch directory
./bin/create_username_dist.sh "$scratchDir"
./bin/create_hours_dist.sh "$scratchDir"
./bin/create_country_dist.sh "$scratchDir"
./bin/assemble_report.sh "$scratchDir"

#Move the summary file generated by assemble report to the current working directory
mv "$scratchDir"/failed_login_summary.html "$PWD"

